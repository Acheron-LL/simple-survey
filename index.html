<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•é—®å·æµ‹è¯•</title>
    <style>
        body { font-family: Arial; max-width: 500px; margin: 40px auto; padding: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background: #28a745; color: white; border: none; padding: 12px 20px; cursor: pointer; }
        button:hover { background: #218838; }
        #message { margin-top: 15px; padding: 10px; display: none; }
    </style>
</head>
<body>
    <h1>ğŸ“ ç®€å•é—®å·æµ‹è¯•</h1>
    <form id="surveyForm">
        <div class="form-group">
            <label for="name">æ‚¨çš„ç§°å‘¼ï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" id="name" name="name" placeholder="å¦‚ï¼šå¼ ä¸‰">
        </div>
        <div class="form-group">
            <label for="rating">æ‚¨çš„æ»¡æ„åº¦ï¼š*</label>
            <select id="rating" name="rating" required>
                <option value="">è¯·é€‰æ‹©</option>
                <option value="5">éå¸¸æ»¡æ„ â­â­â­â­â­</option>
                <option value="4">æ»¡æ„ â­â­â­â­</option>
                <option value="3">ä¸€èˆ¬ â­â­â­</option>
                <option value="2">ä¸æ»¡æ„ â­â­</option>
                <option value="1">éå¸¸ä¸æ»¡æ„ â­</option>
            </select>
        </div>
        <div class="form-group">
            <label for="feedback">æ‚¨çš„æ„è§æˆ–å»ºè®®ï¼š</label>
            <textarea id="feedback" name="feedback" rows="4" placeholder="è¯·å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„æƒ³æ³•..."></textarea>
        </div>
        <button type="submit" id="submitBtn">æäº¤é—®å·</button>
    </form>
    <div id="message"></div>

    <!-- Supabaseåº“ -->
<script src="https://unpkg.com/@supabase/supabase-js@2.39.7"></script>
    
<script>
    // é…ç½®ä¿¡æ¯
    const SUPABASE_URL = 'https://ixdyntvyyldnwcaifqv.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publisible_kacvNfoE7AcK2B6mvSIXQ_t-MvL_';
    
    // å…³é”®ï¼šä½¿ç”¨ä¸åŒçš„å˜é‡åï¼Œé¿å…ä¸åº“å…¨å±€å˜é‡å†²çª
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // è·å–DOMå…ƒç´ 
    const form = document.getElementById('surveyForm');
    const messageEl = document.getElementById('message');
    const submitBtn = document.getElementById('submitBtn');

    // è¡¨å•æäº¤å¤„ç†
    form.addEventListener('submit', async function(event) {
        // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
        event.preventDefault();
        
        // ç¦ç”¨æäº¤æŒ‰é’®é˜²æ­¢é‡å¤æäº¤
        submitBtn.disabled = true;
        submitBtn.textContent = 'æäº¤ä¸­...';
        
        // æ”¶é›†è¡¨å•æ•°æ®
        const formData = new FormData(form);
        const data = {
            name: formData.get('name') || 'åŒ¿å',
            rating: parseInt(formData.get('rating')),
            feedback: formData.get('feedback') || '',
            submitted_at: new Date().toISOString()
        };

        // æ˜¾ç¤ºæäº¤çŠ¶æ€
        messageEl.textContent = 'æ­£åœ¨æäº¤...';
        messageEl.style.display = 'block';
        messageEl.style.background = '#fff3cd';
        messageEl.style.color = '#856404';

        try {
            console.log('æ­£åœ¨æäº¤æ•°æ®:', data);
            
            // æ’å…¥æ•°æ®åˆ°Supabase
            const { error } = await supabaseClient
                .from('survey_responses')
                .insert([data]);

            if (error) {
                console.error('Supabaseé”™è¯¯:', error);
                throw error;
            }

            // æäº¤æˆåŠŸ
            messageEl.textContent = 'âœ… æäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„åé¦ˆã€‚';
            messageEl.style.background = '#d4edda';
            messageEl.style.color = '#155724';
            console.log('æäº¤æˆåŠŸ!');
            
            // é‡ç½®è¡¨å•
            form.reset();
            
        } catch (error) {
            console.error('æäº¤é”™è¯¯:', error);
            messageEl.textContent = 'âŒ æäº¤å¤±è´¥: ' + error.message;
            messageEl.style.background = '#f8d7da';
            messageEl.style.color = '#721c24';
        } finally {
            // æ¢å¤æäº¤æŒ‰é’®
            submitBtn.disabled = false;
            submitBtn.textContent = 'æäº¤é—®å·';
        }
    });
    
    console.log('é—®å·è„šæœ¬åŠ è½½å®Œæˆ');
</script>
</body>
</html>

